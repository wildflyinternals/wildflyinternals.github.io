<p>Tomcat Vault is a tool that allows you to encrypt the passwords in Apache Tomcat configuration files. In this article I’d like to show you how to integrate it into Apache Tomcat.</p>

<p>Here is one line excerpted from <code class="highlighter-rouge">tomcat-users.xml</code>:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;user</span> <span class="na">username=</span><span class="s">"tomcat"</span> <span class="na">password=</span><span class="s">"tomcat"</span> <span class="na">roles=</span><span class="s">"tomcat"</span><span class="nt">/&gt;</span>
</code></pre>
</div>

<p>As we can see above, the password is stored as plaintext and it’s a security risk. Though the configuration in store on server, it’s still very dangerous to store password in such way.</p>

<p>Tomcat Vault is created to solve this problem, it will encrypt your password and store it in standard Java keystore, and let tomcat access the password in a safe way. In this article, I’d like to show you how to use it with Tomcat.</p>

<h3 id="installation-of-apache-tomcat-and-tomcat-vault">Installation of Apache Tomcat and Tomcat Vault</h3>

<p>First we need to have Apache Tomcat<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> and Tomcat-Vault<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> installed on our machine. For Tomcat, I am using 8.0.39 for this article. For Tomcat Vault, I just clone the project from GitHub into my local machine and build it from master branch:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/picketbox/tomcat-vault.git
</code></pre>
</div>

<p>And then using Maven to build and install it:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/Users/weli/projs/tomcat-vault
<span class="gp">$ </span>mvn install
<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] ------------------------------------------------------------------------
<span class="o">[</span>INFO] Building Vault extension <span class="k">for </span>Apache Tomcat 1.0.8.Final
<span class="o">[</span>INFO] ------------------------------------------------------------------------
<span class="o">[</span>INFO]
...
copy dependency file to the correct module directory:
     <span class="o">[</span>copy] Copying 1 file to /Users/weli/projs/tomcat-vault/modules/system/layers/base/tomcat-vault/main
<span class="o">[</span>INFO] Executed tasks
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] --- maven-install-plugin:2.4:install <span class="o">(</span>default-install<span class="o">)</span> @ tomcat-vault ---
<span class="o">[</span>INFO] Installing /Users/weli/projs/tomcat-vault/target/tomcat-vault-1.0.8.Final.jar to /Users/weli/.m2/repository/org/apache/tomcat/tomcat-vault/1.0.8.Final/tomcat-vault-1.0.8.Final.jar
<span class="o">[</span>INFO] Installing /Users/weli/projs/tomcat-vault/pom.xml to /Users/weli/.m2/repository/org/apache/tomcat/tomcat-vault/1.0.8.Final/tomcat-vault-1.0.8.Final.pom
<span class="o">[</span>INFO] Installing /Users/weli/projs/tomcat-vault/target/tomcat-vault-1.0.8.Final-jar-with-dependencies.jar to /Users/weli/.m2/repository/org/apache/tomcat/tomcat-vault/1.0.8.Final/tomcat-vault-1.0.8.Final-jar-with-dependencies.jar
<span class="o">[</span>INFO] ------------------------------------------------------------------------
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] ------------------------------------------------------------------------
<span class="o">[</span>INFO] Total <span class="nb">time</span>: 2.567 s
<span class="o">[</span>INFO] Finished at: 2016-12-20T16:34:53+08:00
<span class="o">[</span>INFO] Final Memory: 17M/265M
<span class="o">[</span>INFO] ------------------------------------------------------------------------
</code></pre>
</div>

<p>After building it, we can get the tomcat-vault jars:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ls -1 target/<span class="k">*</span>.jar
target/tomcat-vault-1.0.8.Final-jar-with-dependencies.jar
target/tomcat-vault-1.0.8.Final.jar
</code></pre>
</div>

<p>Next we will can try to play with <code class="highlighter-rouge">tomcat-vault-1.0.8.Final-jar-with-dependencies.jar</code> to see if it can work correctly. First we should make sure that we are in the ‘target’ directory which contains the generated jar files:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/Users/weli/projs/tomcat-vault/target
<span class="gp">$ </span>ls <span class="k">*</span>.jar
tomcat-vault-1.0.8.Final-jar-with-dependencies.jar tomcat-vault-1.0.8.Final.jar
</code></pre>
</div>

<p>Because the jar file contains a Main class, so we can invoke it like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -classpath tomcat-vault-1.0.8.Final-jar-with-dependencies.jar org.apache.tomcat.vault.VaultTool
<span class="k">**********************************</span>
<span class="k">****</span>  JBoss Vault  <span class="k">***************</span>
<span class="k">**********************************</span>
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
</code></pre>
</div>

<p>If everything goes fine, you can directly using the <code class="highlighter-rouge">java</code> command as shown above to start the <code class="highlighter-rouge">org.apache.tomcat.vault.VaultTool</code>. The next step is to put tomcat-vault jar into our local Apache Tomcat directory:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/Users/weli/projs/apache-tomcat-8.0.39/lib
<span class="gp">$ </span>cp ~/projs/tomcat-vault/target/tomcat-vault-1.0.8.Final-jar-with-dependencies.jar .
</code></pre>
</div>

<p>As the command shown above, we have the tomcat-vault jar with dependecies copied into tomcat lib directory. Till now, the installation step is finished, and next we can start to integrate tomcat-vault with tomcat.</p>

<h3 id="generating-java-keystore-for-tomcat-vault">Generating Java Keystore for Tomcat Vault</h3>

<p>Tomcat Vault relies on Java Keystore to store the passwords, so the first step is to use <code class="highlighter-rouge">keytool</code> command provided by JDK to generate a keystore. Here is the command to generate keystore:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>keytool -genseckey -keystore vault.keystore -alias my_vault -storetype jceks -keyalg AES -keysize 128 -storepass my_password123 -keypass my_password123 -validity 730
</code></pre>
</div>

<p>As the command shown above, we have generated a keystore named <code class="highlighter-rouge">vault.keystore</code>, and set the password of the store to <code class="highlighter-rouge">my_password123</code>. We also generate a key pair with the <code class="highlighter-rouge">alias</code> name <code class="highlighter-rouge">my_vault</code>, and set the password of this generated key pair to <code class="highlighter-rouge">my_password123</code> (You should use different password for key store and key pair in production environment). Please note that I have put the above generated keystore file to <code class="highlighter-rouge">conf</code> directory of Tomcat:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/Users/weli/projs/apache-tomcat-8.0.39/conf
<span class="gp">$ </span>ls vault.keystore
vault.keystore
</code></pre>
</div>

<p>In production environment, you should put the keystore into a safer place and set the permission of the file properly. Now we can check this keystore by using the <code class="highlighter-rouge">keytool</code> command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>keytool -list -v -keystore vault.keystore -storetype jceks -storepass my_password123

Keystore <span class="nb">type</span>: JCEKS
Keystore provider: SunJCE

Your keystore contains 1 entry

Alias name: my_vault
Creation date: Dec 20, 2016
Entry <span class="nb">type</span>: SecretKeyEntry


<span class="k">*******************************************</span>
<span class="k">*******************************************</span>
</code></pre>
</div>

<p>As the command output shown above, we can see our keystore contains one <code class="highlighter-rouge">SecretKeyEntry</code> named <code class="highlighter-rouge">my_vault</code>. Till now, we have generated the keystore for tomcat vault to use. The next step is to invoke tomcat vault to initialize the keystore for us.</p>

<h3 id="initializing-tomcat-vault">Initializing Tomcat Vault</h3>

<p>Now we can invoke tomcat vault to initialize the keystore so it can be used to store tomcat username and password information. First we need to go to the <code class="highlighter-rouge">lib</code> directory of tomcat, because in previous steps we have put tomcat-vault jar into it:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/Users/weli/projs/apache-tomcat-8.0.39/lib
<span class="gp">$ </span>ls tomcat-vault<span class="k">*</span>
tomcat-vault-1.0.8.Final-jar-with-dependencies.jar
</code></pre>
</div>

<p>We need to invoke the above tomcat-vault jar to initialize the keystore we generated in previous step, which is named <code class="highlighter-rouge">vault.keystore</code>. Here is the whole step to use tomcat-vault to initialize the keystore:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -classpath tomcat-vault-1.0.8.Final-jar-with-dependencies.jar org.apache.tomcat.vault.VaultTool
<span class="k">**********************************</span>
<span class="k">****</span>  JBoss Vault  <span class="k">***************</span>
<span class="k">**********************************</span>
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:/Users/weli/projs/apache-tomcat-8.0.39/conf
Enter Keystore URL:/Users/weli/projs/apache-tomcat-8.0.39/conf/vault.keystore
Enter Keystore password:
Enter Keystore password again:
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number <span class="o">(</span>Eg: 44<span class="o">)</span>:120
Enter Keystore Alias:my_vault
Initializing Vault
Dec 21, 2016 3:43:33 PM org.apache.tomcat.vault.security.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration <span class="k">in </span>tomcat properties file:
<span class="k">********************************************</span>
...
<span class="nv">KEYSTORE_URL</span><span class="o">=</span>/Users/weli/projs/apache-tomcat-8.0.39/conf/vault.keystore
<span class="nv">KEYSTORE_PASSWORD</span><span class="o">=</span>MASK-3CuP21KMHn7G6iH/A3YpM/
<span class="nv">KEYSTORE_ALIAS</span><span class="o">=</span>my_vault
<span class="nv">SALT</span><span class="o">=</span>1234abcd
<span class="nv">ITERATION_COUNT</span><span class="o">=</span>120
<span class="nv">ENC_FILE_DIR</span><span class="o">=</span>/Users/weli/projs/apache-tomcat-8.0.39/conf/
...
<span class="k">********************************************</span>
Vault is initialized and ready <span class="k">for </span>use
Handshake with Vault <span class="nb">complete
</span>Please enter a Digit::   0: Store a secured attribute  1: Check whether a secured attribute exists  2: Exit
2
</code></pre>
</div>

<p>Above is the whole step to use tomcat-vault to initialize the keystore. Let’s see the above process step by step. Here is the explanation:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
</code></pre>
</div>

<p>We choose <code class="highlighter-rouge">0</code> to start an interactive session to initialize keystore with tomcat-vault.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>Enter directory to store encrypted files:/Users/weli/projs/apache-tomcat-8.0.39/conf
</code></pre>
</div>

<p>We have assigned a directory to store tomcat-vault encrypted data file. The data file is used to store username and password information, and it’s encrypted by the key pair in the key store.</p>

<p>We will configure tomcat-vault to use <code class="highlighter-rouge">vault.keystore</code>, and we will also configure tomcat-vault to use the key pair <code class="highlighter-rouge">my_vault</code> in <code class="highlighter-rouge">vault.keystore</code> for encryption in following steps.</p>

<p>Let go on seeing the configuration process:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>Enter Keystore URL:/Users/weli/projs/apache-tomcat-8.0.39/conf/vault.keystore
Enter Keystore password: my_password123
Enter Keystore password again: my_password123
Values match
</code></pre>
</div>

<p>Here we enter the keystore password so tomcat-vault can access it and use the key pair inside for data encryption. Let’s see the next step:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>Enter 8 character salt:1234abcd
Enter iteration count as a number <span class="o">(</span>Eg: 44<span class="o">)</span>:120
Enter Keystore Alias:my_vault
Initializing Vault
</code></pre>
</div>

<p>Here we need to enter ‘salt’ and ‘iteration count’ as we like, these two attributes are used by tomcat-vault to encrypt its data file. After all above parameters are set, tomcat-vault will finish the initialization process and output the settings:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">KEYSTORE_URL</span><span class="o">=</span>/Users/weli/projs/apache-tomcat-8.0.39/conf/vault.keystore
<span class="nv">KEYSTORE_PASSWORD</span><span class="o">=</span>MASK-3CuP21KMHn7G6iH/A3YpM/
<span class="nv">KEYSTORE_ALIAS</span><span class="o">=</span>my_vault
<span class="nv">SALT</span><span class="o">=</span>1234abcd
<span class="nv">ITERATION_COUNT</span><span class="o">=</span>120
<span class="nv">ENC_FILE_DIR</span><span class="o">=</span>/Users/weli/projs/apache-tomcat-8.0.39/conf/
</code></pre>
</div>

<p>We need to store above config into a file. In this article, I put above config into a file named <code class="highlighter-rouge">vault.properties</code> and put it into <code class="highlighter-rouge">conf</code> directory of tomcat:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/Users/weli/projs/apache-tomcat-8.0.39/conf
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ls vault.properties
vault.properties
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>cat vault.properties
<span class="nv">KEYSTORE_URL</span><span class="o">=</span>../conf/vault.keystore
<span class="nv">KEYSTORE_PASSWORD</span><span class="o">=</span>MASK-3CuP21KMHn7G6iH/A3YpM/
<span class="nv">KEYSTORE_ALIAS</span><span class="o">=</span>my_vault
<span class="nv">SALT</span><span class="o">=</span>1234abcd
<span class="nv">ITERATION_COUNT</span><span class="o">=</span>120
<span class="nv">ENC_FILE_DIR</span><span class="o">=</span>../conf/
</code></pre>
</div>

<p>From the above <code class="highlighter-rouge">ENC_FILE_DIR</code> setting, we can see the place where tomcat-vault put its data file in. Please note that we can use relative path in <code class="highlighter-rouge">KEYSTORE_URL</code> and <code class="highlighter-rouge">ENC_FILE_DIR</code> settings. Now let’s check whether the <code class="highlighter-rouge">VAULT.dat</code> is in position:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/Users/weli/projs/apache-tomcat-8.0.39/conf
<span class="gp">$ </span>ls VAULT.dat
VAULT.dat
</code></pre>
</div>

<p>As the command output shown above, we can see the default name of the data file used by tomcat-vault is <code class="highlighter-rouge">VAULT.dat</code>. Till now, we have three files generated into <code class="highlighter-rouge">conf</code> directory:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>find . | grep -i vault
./VAULT.dat
./vault.keystore
./vault.properties
</code></pre>
</div>

<p>In production environment, you should put above files into a safer place. Now we have finished initializing tomcat vault, the next step is to configure the tomcat to use the vault.</p>

<h3 id="configuring-tomcat-to-use-vault">Configuring Tomcat To Use Vault</h3>

<p>Now we can configure Tomcat to use Tomcat-Vault. For the first step, we need to put one line configuration into <code class="highlighter-rouge">conf/catalina.properties</code>:</p>

<div class="language-conf highlighter-rouge"><pre class="highlight"><code><span class="n">org</span>.<span class="n">apache</span>.<span class="n">tomcat</span>.<span class="n">util</span>.<span class="n">digester</span>.<span class="n">PROPERTY_SOURCE</span>=<span class="n">org</span>.<span class="n">apache</span>.<span class="n">tomcat</span>.<span class="n">vault</span>.<span class="n">util</span>.<span class="n">PropertySourceVault</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">catalina.properties</code> is a long file, and you can just put the above configuration at the bottom of the file. This will load tomcat-vault into Tomcat during server startup, and it will use <code class="highlighter-rouge">vault.properties</code> in <code class="highlighter-rouge">conf</code> directory by default.</p>

<p>Now we will use <code class="highlighter-rouge">tomcat-vault</code> to generate a manager password for Tomcat. This password will be encrypted by the <code class="highlighter-rouge">SecretKeyEntry</code> in keystore. We need to find the tomcat-vault jar correctly, and if you follow the steps previously, it should be located in <code class="highlighter-rouge">lib</code> directory of Tomcat:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>lib/tomcat-vault-1.0.8.Final-jar-with-dependencies.jar
</code></pre>
</div>

<p>Now we can use <code class="highlighter-rouge">java</code> to run the jar to start tomcat-vault command line interface. Here is the command to do so:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -classpath lib/tomcat-vault-1.0.8.Final-jar-with-dependencies.jar <span class="se">\</span>
org.apache.tomcat.vault.VaultTool <span class="se">\</span>
--keystore conf/vault.keystore <span class="se">\</span>
--keystore-password my_password123 <span class="se">\</span>
--alias my_vault <span class="se">\</span>
--enc-dir conf/ <span class="se">\</span>
--iteration 120 <span class="se">\</span>
--salt 1234abcd <span class="se">\</span>
--vault-block my_block <span class="se">\</span>
--attribute manager_password <span class="se">\</span>
--sec-attr P@SSW0#D
</code></pre>
</div>

<p>I’m running the above command under the root of tomcat directory, so I can add <code class="highlighter-rouge">lib/</code> and <code class="highlighter-rouge">conf/</code> in the filepath so the <code class="highlighter-rouge">VaultTool</code> can find keystore file and vault data file correctly.</p>

<p>In addition, please see I have requested tomcat-vault to add a password named <code class="highlighter-rouge">manager_password</code> into vault data, and the value of the password is <code class="highlighter-rouge">P@SSW0#D</code>. Here is the output result of above command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>Jan 04, 2017 11:52:33 PM org.apache.tomcat.vault.security.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Secured attribute value has been stored <span class="k">in </span>vault.
Please make note of the following:
<span class="k">********************************************</span>
Vault Block:my_block
Attribute Name:manager_password
Shared Key:
Configuration should be <span class="k">done </span>as follows:
VAULT::my_block::manager_password::
<span class="k">********************************************</span>
Vault Configuration <span class="k">in </span>tomcat properties file:
<span class="k">********************************************</span>
...
<span class="nv">KEYSTORE_URL</span><span class="o">=</span>conf/vault.keystore
<span class="nv">KEYSTORE_PASSWORD</span><span class="o">=</span>MASK-3CuP21KMHn7G6iH/A3YpM/
<span class="nv">KEYSTORE_ALIAS</span><span class="o">=</span>my_vault
<span class="nv">SALT</span><span class="o">=</span>1234abcd
<span class="nv">ITERATION_COUNT</span><span class="o">=</span>120
<span class="nv">ENC_FILE_DIR</span><span class="o">=</span>conf/
...
<span class="k">********************************************</span>
</code></pre>
</div>

<p>As the result output shown above, we can now refer to <code class="highlighter-rouge">manager_password</code> in Tomcat configuration, and it will point to the true password <code class="highlighter-rouge">P@SSW0#D</code> in <code class="highlighter-rouge">VAULT.dat</code>. The true password is encrypted by the <code class="highlighter-rouge">SecretKeyEntry</code> in keystore, and only Tomcat can access it with the masked password <code class="highlighter-rouge">KEYSTORE_PASSWORD</code> configured in <code class="highlighter-rouge">vault.properties</code>.</p>

<p>Now let’s use the <code class="highlighter-rouge">manager_password</code> in Tomcat configuration. We can use it as the password of Tomcat user <code class="highlighter-rouge">manager</code>. The first step is to open <code class="highlighter-rouge">conf/tomcat-users.xml</code>, and then we can put one line of user data at the bottom of this file:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;user</span> <span class="na">username=</span><span class="s">"manager"</span> <span class="na">password=</span><span class="s">"${VAULT::my_block::manager_password::}"</span> <span class="na">roles=</span><span class="s">"manager-gui"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>As the configuration shown above, we can see the password of <code class="highlighter-rouge">manager</code> is no longer plaintext, but a reference to the entry in VAULT. Till now, all the configurations are done and we are ready to start the Tomcat server for testing.</p>

<h3 id="testing-tomcat-vault-integration">Testing Tomcat-Vault Integration</h3>

<p>Now we can start the Tomcat server to test our configuration. Firstly, we need to start the server using the script <code class="highlighter-rouge">startup.sh</code> in <code class="highlighter-rouge">bin</code>:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>./startup.sh
Using CATALINA_BASE:   /Users/weli/projs/thoughts-on-jboss-webserver/apache-tomcat-8.0.39
Using CATALINA_HOME:   /Users/weli/projs/thoughts-on-jboss-webserver/apache-tomcat-8.0.39
Using CATALINA_TMPDIR: /Users/weli/projs/thoughts-on-jboss-webserver/apache-tomcat-8.0.39/temp
Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk1.8.0_66.jdk/Contents/Home
Using CLASSPATH:       /Users/weli/projs/thoughts-on-jboss-webserver/apache-tomcat-8.0.39/bin/bootstrap.jar:/Users/weli/projs/thoughts-on-jboss-webserver/apache-tomcat-8.0.39/bin/tomcat-juli.jar
Tomcat started.
</code></pre>
</div>

<p>From the above log output we can see Tomcat is started, and now let’s check whether tomcat-vault is loaded correctly. We can do a <code class="highlighter-rouge">grep</code> at <code class="highlighter-rouge">catalian.out</code> in the <code class="highlighter-rouge">log</code> directory of Tomcat:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>cat catalina.out  | grep -i vault
05-Jan-2017 22:02:39.410 INFO <span class="o">[</span>main] org.apache.tomcat.vault.security.vault.PicketBoxSecurityVault.init PBOX000361: Default Security Vault Implementation Initialized and Ready
</code></pre>
</div>

<p>As the result shown above, we can see tomcat-vault is loaded correctly. The next step to verify that we can use the password stored in <code class="highlighter-rouge">VAULT.dat</code> for account <code class="highlighter-rouge">manager</code>. By default the Tomcat server is listening on port <code class="highlighter-rouge">8080</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>http://127.0.0.1:8080
</code></pre>
</div>

<p>We can access the URL shown above and get the following page:</p>

<p><img src="/assets/vault01.png" alt="Tomcat Default Page" /></p>

<p>As the image shown above, we can see the default homepage of our Tomcat server. There is a button named <code class="highlighter-rouge">Manager App</code> at top-right of the page, please click it, and the login window will popup:</p>

<p><img src="/assets/vault02.png" alt="Login Page" /></p>

<p>We can input <code class="highlighter-rouge">manager</code> in <code class="highlighter-rouge">Name</code> field, and in <code class="highlighter-rouge">Password</code> field we can input <code class="highlighter-rouge">P@SSW0#D</code> as we set before. If tomcat-vault is working, then Tomcat should accept the password, though it’s encrypted and stored in <code class="highlighter-rouge">VAULT.dat</code>. Let’s try it:</p>

<p><img src="/assets/vault03.png" alt="Enter username and password" /></p>

<p>The authentication is passed and we entered the manager page:</p>

<p><img src="/assets/vault04.png" alt="Manager Page" /></p>

<p>Till now we have gone through all the steps to integrate Tomcat-Vault into Tomcat. I have put a complete tomcat server into this repository, and it contains all the configuration files and keystore files we have used in this article. You can check it out and play with it</p>

<h3 id="references"><em>References</em></h3>

<hr />
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="http://tomcat.apache.org/">http://tomcat.apache.org/</a>&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><a href="https://github.com/picketbox/tomcat-vault">https://github.com/picketbox/tomcat-vault</a>&nbsp;<a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
